---
title: "BST210 Project EDA" 
---

# Exploratory Data Analysis

```{r}
library(tidyverse)
library(stringr)
library(viridisLite) # nice colours
```

## What's the structure of our data?

```{r}
dat <- read_csv("cancer_reg.csv")
str(dat)
summary(dat)
```
From the summary above, we can observe that we have a lot of variables to consider to answer our main questions. Additionally, it tells us about the complexity about the data itself in that cancer prevalence is a factor of many socioeconomic factors.

## How much missing data is there?

```{r}
no_geodat <- dat %>% select(-c("Geography", "binnedInc")) # no missing counties
no_geodat[!complete.cases(no_geodat),] %>%  # keep rows with NAs
    pivot_longer(colnames(no_geodat), names_to = "Covariates", values_to = "Values") %>% # pivot into long table
    filter(is.na(Values)) %>% # filter out all the non-na's
    ggplot(aes(x = Covariates)) + 
    geom_bar(position = "dodge", aes(col = Covariates, fill = Covariates)) + 
    theme_bw() + 
    scale_fill_viridis_d() + 
    scale_color_viridis_d()


```

Interestingly, there is some missing data in the reporting of county employment for residents age 16 and over. We observe more missing data in percentages of county residents with only private healthcare coverage, and missing data in the majority of counties for reports of the percent of county residents between 18 and 24 years old with with some college as their highest attained education. One hypothesis for why there may be a large amount of missing data in educational reporting for 18 to 24 year olds with some college may be because some counties may not have high emphasis on higher education and many individuals in this age range that are pursuing college will probably be in more college-oriented counties.


## Exploring data patterns and modeling

```{r, fig.width=10, fig.height=10}
pairs(dat %>% select(where(is.numeric)))
```

However, showing all of the variables is somewhat ineffective in showing the the relationship between the variables. A few variables that are strongly correlated are singled out for better visibility.

```{r}
plot(dat$PctPublicCoverageAlone, dat$PctPublicCoverage, xlab = "Percent Public Coverage Alone", ylab = "Percent Public Coverage")
```

It is self explanatory that the higher the percentage of the county population is under public healthcare, the higher the percentage of the county single persons is under public healthcare. 

```{r}
plot(dat$avgAnnCount, dat$popEst2015, xlab = "Annual cancer diagnosis count", ylab = "county population ")
```

This is another expected correlation. The higher the population is, the more cancer occurance will be in the population. 

```{r}
plot(dat$medIncome,dat$TARGET_deathRate,  ylab = "Cancer related death rate", xlab = "county median income")
```

This is an example of significant predictors for our model. Annual income is likely very correlated with the # of cancer related death rate. However, we need to further explore what kind of model will be best fit for the data. 

```{r}
plot(dat$AvgHouseholdSize,dat$TARGET_deathRate,  ylab = "Cancer related death rate", xlab = "Average household size")
```

As the plot suggests, there isn't a clear relationship between cancer-related death rate and the average household size. However, furtherwork could help illustrate some latent meanings. 

```{r}
plot(dat$PercentMarried,dat$TARGET_deathRate,  ylab = "Cancer related death rate", xlab = "Percentage of married person in the County")
```

It seems that there is a negative association between percent of people married and cancer-related death rate. This seems to be another valuable predictor that we could use in our model. 

These graphs are a brief look into the possible associations within our data set. We need to be careful that some of these relationships might be confounded by other co-variates, We also need to conduct confounding analysis (both classical, and statistical), effect modifier analysis to figure out the nature of the associations. 

### Look at the state-wide view

```{r}
dat <- dat %>%
    mutate(state = str_extract(Geography, "[^,]+$")) %>% # regex to select everything after ','
    mutate(state = str_trim(state))
```

```{r}
dat %>%
    ggplot(aes(x = state, y = avgDeathsPerYear, colour = state, fill = state)) +
    geom_boxplot() + 
    theme_bw() + 
    coord_flip()
```

It appears that there are some potential outliers when studying the relationship between states and average deaths per year due to cancer. Particularly, there may be potential outliers in the data for California, Illinois, and Arizona. We would need to further examine the reasons for such a large deviation from the rest of the data. Additionally, it appears that the more populated states, such as California and New York, have a higher average death rate compared to less populated states like Wyoming. 
